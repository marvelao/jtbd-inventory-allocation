# JTBD库存分配系统

## 项目简介

基于JTBD（Jobs-to-be-Done）理念的库存分配系统，用于解决A、B两款机型共用物料的库存竞争问题。系统可根据业务优先级自动分配库存，并量化评估各机型的生产需求满足程度。

## 功能特性

### 1. 基础配置层
- 支持录入/维护A、B两款机型的基础信息
- 自动识别并标记重复的物料编码
- 从数据库加载可用机型列表

### 2. 参数设置层
- 独立设置A、B机型的"计划制造数量"
- 灵活指定两款机型的"库存分配优先级"（高优先级/低优先级）
- 加载和展示机型BOM数据

### 3. 库存分配层
- 基于制造数量、优先级和现有库存进行自动分配
- 优先满足高优先级机型的需求
- 区分共用物料和专属物料的分配逻辑

### 4. 结果计算层
- 自动计算机型的"库存满足率"
- 满足率 = 实际可制造数量 / 计划制造数量 × 100%
- 精准追溯数据来源

### 5. 结果展示层
- 清晰呈现各机型的物料分配明细
- 展示优先级、制造数量、满足率等核心数据
- 可视化展示物料分配总览

## 技术栈

- **编程语言**: Python 3.x
- **UI框架**: tkinter
- **数据库**: SQL Server
- **ORM**: SQLAlchemy
- **数据库驱动**: pyodbc

## 数据库配置

### 连接信息
```

```

### 数据表

#### 物料库存表 (XZB_InvNum)
| 列名 | 数据类型 | 备注 |
|------|----------|------|
| MATNR | nvarchar(500) | Component_ItemNumber（物料编码） |
| CLABS | float | 库存数量 |

#### 机型BOM表 (XZB_Forcast_BOM)
| 列名 | 数据类型 | 备注 |
|------|----------|------|
| Parent_ItemNumber | nvarchar(500) | 父项编码 |
| Component_ItemNumber | nvarchar(500) | 子项编码 |
| Component_ItemNumber Description | nvarchar(500) | 子项描述 |
| Component_ItemNumber Num | float | 子项数量 |

## 项目结构

```
inventory_allocation_app/
├── main.py                 # 主程序入口
├── database/
│   ├── __init__.py
│   ├── config.py           # 数据库配置
│   ├── connection.py       # 数据库连接管理
│   └── models.py          # 数据模型
├── ui/
│   ├── __init__.py
│   ├── main_window.py     # 主界面
│   ├── config_frame.py    # 配置界面
│   └── result_frame.py    # 结果展示
├── core/
│   ├── __init__.py
│   ├── allocation.py      # 库存分配算法
│   └── calculator.py      # 满足率计算
├── utils/
│   ├── __init__.py
│   └── helpers.py         # 工具函数
└── requirements.txt        # 依赖包
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 启动程序
```bash
python main.py
```

### 2. 操作流程

#### 步骤1: 配置机型A
1. 切换到"机型 A"标签页
2. 从下拉列表选择机型编码
3. 输入机型名称（可选）
4. 设置计划制造数量
5. 设置分配优先级（高优先级/低优先级）
6. 点击"加载BOM数据"按钮
7. 确认BOM物料清单加载成功

#### 步骤2: 配置机型B
1. 切换到"机型 B"标签页
2. 重复机型A的配置步骤
3. 注意设置不同的优先级以体现优先分配规则

#### 步骤3: 执行分配
1. 点击"执行库存分配"按钮
2. 系统将自动按照优先级规则分配库存
3. 分配完成后会弹出成功提示

#### 步骤4: 查看结果
1. 切换到"总览"标签页查看分配统计
2. 切换到"机型 A 详情"或"机型 B 详情"标签页查看详细分配信息
3. 查看满足率进度条和物料分配明细

### 3. 清空数据
点击"清空所有数据"按钮可重置所有配置和结果。

## 分配逻辑说明

### 1. 物料分类
- **共用物料**: 在A、B两个机型BOM中都存在的物料
- **专属物料**: 只在某个机型BOM中存在的物料

### 2. 分配规则
1. **专属物料分配**: 直接分配给对应机型，不受优先级影响
2. **共用物料分配**: 按优先级依次分配
   - 高优先级机型先分配
   - 库存充足时，低优先级机型再分配
   - 库存不足时，低优先级机型可能短缺

### 3. 满足率计算
- 满足率 = 实际可制造数量 / 计划制造数量 × 100%
- 实际可制造数量受最紧缺物料的限制
- 例如：如果某个物料只满足需求的50%，则整机满足率也为50%

## 系统约束

- 支持A、B两款机型
- 需兼容"部分物料编码重复"的现状
- 优先级设置支持灵活调整
- 满足率计算精准对应各机型的计划制造数量
- 数据可追溯

## 成功标准

✅ 库存分配结果符合预设的优先级规则  
✅ 重复物料编码的库存被合理分配，无超量/漏分配情况  
✅ 各机型的满足率计算准确，可直接用于生产计划决策  
✅ 操作流程简洁，库存分配结果可快速生成并可视化展示  

## 注意事项

1. 确保数据库连接配置正确
2. 确保ODBC Driver 17 for SQL Server已安装
3. 计划制造数量必须大于0才能执行分配
4. 必须先加载BOM数据才能执行分配
5. 两个机型的优先级不应相同，否则将按顺序分配

## 故障排除

### 数据库连接失败
- 检查数据库服务器是否可访问
- 检查用户名密码是否正确
- 确认ODBC驱动已安装

### 找不到BOM数据
- 检查机型编码是否正确
- 确认数据库中是否存在该机型的BOM数据
- 尝试刷新机型列表

### 分配失败
- 确保两个机型都已配置完成
- 确认已加载BOM数据
- 检查计划制造数量是否大于0

## 技术支持

如有问题，请联系系统管理员。

## 版本信息

- 版本: 1.0.0
- 开发日期: 2026-01-16
